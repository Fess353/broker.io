"use strict";let centerCat=document.querySelector(".main-page__center-cat"),centerCatCash=document.querySelector(".main-page__center-cat-cash"),leftCat=document.querySelector(".main-page__left-cat"),rightCat=document.querySelector(".main-page__right-cat"),resultCat=document.querySelector(".main-page__result-cat"),background=document.querySelectorAll(".background__animation-container"),title=document.querySelector(".title"),question=document.querySelector(".question"),tail=document.querySelector(".question__tail"),mainPageButton=document.querySelector(".main-page__button"),answersContainer=document.querySelector(".answers"),answers=document.querySelectorAll(".answers__button"),resultType=document.querySelector(".main-page__result-type"),resultText=document.querySelector(".main-page__result-text"),resultTitle=document.querySelector(".main-page__result-title"),finalBlock=document.querySelector(".final-block"),finalBlockTitle=document.querySelector(".final-block__title"),sendButton=document.querySelector(".js_validate"),emailInput=document.querySelector(".final-block__email-input"),checkbox=document.querySelector(".final-block__checkbox-input"),$error=$(".final-block__email-error"),popup=document.querySelector(".main-page__popup-final-wrapper"),popupCloseBtn=document.querySelector(".popup-final__close-btn"),finalBlockArrow=document.querySelector(".final-block__arrow"),checkboxLabel=document.querySelector(".final-block__checkbox-label"),catCounter=1,pageCounter=0,resultArray=[];for(let e=0;e<answers.length;e++)answers[e].dataset.num=e;function cssTrick(){let e=$(window).height(),t=$(window).width();document.querySelector("meta[name=viewport]").setAttribute("content","height="+e+", width="+t+", initial-scale=1.0")}function stopCssTrick(){let e=document.querySelector("meta[name=viewport]");setTimeout(()=>{e.setAttribute("content","width=device-width, height=device-height, initial-scale=1.0 maximum-scale=1.0")},200)}function changeLinksToVisited(e){"IMG"===e.target.nodeName&&$(e.target).closest(".final-block__social-btn").hasClass("final-block__social-btn")&&($(e.target).closest(".final-block__social-btn").addClass("final-block__social-btn_visited"),$(e.target).addClass("final-block__social-icon_visited"))}window.onload=function(){$(window).width()<768&&$("html, body").animate({scrollTop:$(mainPageButton).offset().top},{duration:400,easing:"linear"})},emailInput.addEventListener("focus",cssTrick),emailInput.addEventListener("blur",stopCssTrick),popupCloseBtn.onclick=function(){$(popup).fadeOut(400)},document.addEventListener("click",changeLinksToVisited);let questionsArray=["В 2018 году США и Китай снова что-то не поделили и развязали торговую войну. Фондовый рынок США сначала упал на 10%, а через три месяца взлетел.","Одна летучая мышь не только разрушила наши планы на 2020 год, но и обвалила фондовый рынок почти на 50%. И хоть пандемия продолжается, биржа уверенно восстанавливается.","В 2012 году в акции Facebook никто не верил, как сегодня никто не верит в новый дизайн. Сейчас активы выросли в цене почти в семь раз и стоят $264","Небольшая фармацевтическая компания Moderna сказала, что мы спасены. Она разработала и успешно испытала вакцину против коронавируса. После этого акции компании выросли с $30 до $90","Акции Boeing ещё держались после того, как 737-MAX перестали использовать все авиакомпании, а производство остановилось. А вот пандемия здорово их пошатнула"],catsDescriptionArray=['Твой портфель идеально сбалансирован, а будущее расписано на пять лет вперед. Что ещё надо? Например, научиться эффективно действовать в непредвиденных ситуациях. <a class="main-page__result-link" href="#" rel="noopener" target="_blank">«Открытие Брокер» подготовил для тебя несколько идей.</a>','Ураган страсти, заключенный в теле инвестора. Ты найдёшь применение любым активам. У нас для тебя кое что есть — зарегистрируйся в «Открытие Брокер» и получи акцию в подарок. <a class="main-page__result-link" href="#" rel="noopener" target="_blank"> Подробности здесь </a>','Действуешь вопреки общей тенденции, а иногда и вопреки здравому смыслу? Временами прокатывает? Поздравляем. Но ты же знаешь, что можешь больше. <a class="main-page__result-link" href="#" rel="noopener" target="_blank"> Если тебе тоже не даёт покоя звезда Уоррена Баффета, учись инвестировать с умом. </a>','Свой капитал ты сохранишь. Несмотря на инфляцию, пандемию, падение метеорита или высадку инопланетян. Если хочешь больше зарабатывать на инвестициях — <a class="main-page__result-link" href="#" rel="noopener" target="_blank"> жми сюда. </a>','В розыгрышах, конечно, приятно участвовать. Но сейчас даже школьник знает, как торговать на бирже. Поэтому мы для тебя подготовили программу бесплатного обучения. А если <a class="main-page__result-link" href="#" rel="noopener" target="_blank"> зарегистрируешься с этого сайта </a>, подарим акцию'],catsTypeArray=["Инвестор-дотошка","Инвестор от бога","Инвестор-авантюрист","Инвестор-перестраховщик","Инвестор-падаван"],answersArray=[["Мастера Дзена учили меня балансу. Продам 10% активов.","Буду шортить индекс S&P 500 с коротким стопом.","Раз график ползёт вверх, куплю фьючерс на NASDAQ с «плечом»","Мой путь — наблюдать за ростом","Пока не знаю — хочу приз!"],[" Раз акции, имбирь и гречка растут в цене, их я и возьму."," Однажды все будут здоровы, а я пока куплю акции фармацевтических компаний. "," Полюбуюсь паникой брокеров и вложу деньги в ETF-фонды. "," Обменяю деньги с депозита на облигации. Мой девиз: медленно, но верно! "," Я планирую выиграть путешествие. Моё действие — отдых. "],["Сокращу долю акций в своём портфеле с 4% до 2%","Думаю зашортить акции с коротким стоп-лоссом. Делаю так, потому что знаю, что означают эти слова","Куплю ещё акций — Дуров всё равно не вернул стену","Оставлю акции и подарю своим внукам на совершеннолетие","Сокращу долю акций в своём портфеле с 4% до 2%"],["Сокращу долю акций Moderna в портфеле — не резиновый","Если дотянут до $100, быстро продам акции. Пока поищу ещё каких-нибудь умников","Куплю пока акции Pfizer. Чем они хуже?! ","После 90 жизнь только начинается. Я подожду.","Мы уже закончили?"],["У меня портфеле уже лежат Delta Air Lines и Aeroflot. Зачем мне Boeing?","Поставлю короткий стоп-лосс. Посмеют хоть немного упасть — программа их продаст","Спорим, акции скоро рухнут?! Ставлю на падение 2 к 1","С глаз долой, из портфеля — вон","А сейчас? Пора переходить к награждению!"]];function writeResultData(e){"BUTTON"===e.target.nodeName&&void 0!==e.target.dataset.num&&resultArray.push(e.target.dataset.num)}function loadCat(e){e%2==0?$(leftCat).transit({x:"300px",opacity:"1"},400):$(rightCat).transit({x:"-300px",opacity:"1"},400)}function removeCat(e){e%2==0?$(leftCat).transit({x:"-300px",opacity:"1"},400):$(rightCat).transit({x:"300px",opacity:"1"},400),catCounter++}function showQuestionTail(e){e%2!=0?($(tail).transit({rotateY:"0"}),setTimeout(()=>{$(tail).transit({x:"10vw",opacity:"1"},200)},300)):setTimeout(()=>{$(tail).transit({rotateY:"180deg"}).transit({x:"20vw",opacity:"1"},200)},300)}function answersAddListenerToAnswer(e){"BUTTON"===e.target.nodeName&&e.target.classList.contains("answers__button")&&loadNewQuestion(e.target.dataset.num)}function loadAnswers(){$(".main-page__answers-container").css("display","block"),answersContainer.scrollTop=0,$(window).width()<768?$(question).transit({y:"-80px",scale:"0.6"},300):$(window).width()<1399?$(question).transit({y:"-40px",scale:"0.80"},300):$(question).transit({y:"-40px",scale:"0.84"},300),$(mainPageButton).transit({y:"300px",opacity:"0"},300),$(tail).transit({opacity:"0"},100),$(answersContainer).transit({opacity:"1"},500),removeCat(catCounter),function(e){for(let t=0;t<answers.length;t++)answers[t].textContent=answersArray[e][t]}(pageCounter),document.addEventListener("click",answersAddListenerToAnswer)}function scrollToButtonMobile(){$(window).width()<768&&$("html, body").animate({scrollTop:$(mainPageButton).offset().top},{duration:200,easing:"linear"})}function nextQuestion(e){pageCounter>0&&($(question).transit({y:"0",scale:"1"},300),$(answersContainer).transit({opacity:"0"},200)),$(".main-page__answers-container").css("display","none"),question.textContent=questionsArray[e],loadCat(catCounter),showQuestionTail(catCounter),setTimeout(()=>{mainPageButton.textContent="Что будешь делать?"},400),$(mainPageButton).transit({y:"0",opacity:"1"},100),$(question).transit({x:"-100px",opacity:"1"},400),mainPageButton.addEventListener("click",loadAnswers),setTimeout(()=>{scrollToButtonMobile()},200)}function hideFirstPage(){mainPageButton.removeEventListener("click",hideFirstPage),$(centerCat).transit({y:"300px",opacity:"0"},500),$(mainPageButton).transit({y:"300px",opacity:"0"},400),$(title).transit({rotateY:"90deg",opacity:"0"},300),$(".main-page__question-container").css("display","block"),$(".main-page__rules-button").transit({x:"400px",opacity:"0"},500).css("display","none"),$(".main-page__footer").css("display","none"),$(".main-page").css("overflow-y","hidden"),$(centerCatCash).transit({opacity:0,top:"+=1500"},400).fadeOut(1),$(background).stop().transit({opacity:0},400,"linear",nextQuestion(pageCounter)),setTimeout(()=>{$(background).css("display","none")},400)}document.addEventListener("click",writeResultData),mainPageButton.addEventListener("click",hideFirstPage);const maxOccurences=e=>Array.from(e.reduce((e,t)=>e.set(t,e.has(t)?e.get(t)+1:1),new Map).entries()).reduce((e,t)=>t[1]>e[1]?t:e).reduce((e,t)=>({item:e,count:t}));function showFinalBlock(){setTimeout(()=>{$(finalBlock).transit({opacity:"1"},500)},2e3)}function loadResultPage(){let e=maxOccurences(resultArray).item;resultType.textContent=catsTypeArray[e],resultText.innerHTML=catsDescriptionArray[e],$(".main-page__result").css("display","flex"),$(answersContainer).transit({opacity:"0"},300),setTimeout(()=>{$(".main-page__answers-container").css("display","none"),$(".main-page__question-container").css("display","none"),$(".main-page__center-cat").css("display","none")},300),setTimeout(()=>{$(".main-page__final-block").css("display","block")},2500),resultCat.insertAdjacentHTML("beforeend",`<picture class="main-page__result-cat-picture">\n\t\t<source srcset="img/cat_result_xs${e}.webp" media="(max-width: 767px)" type="image/webp">\n\t\t<source srcset="img/cat_result_sm${e}.webp" type="image/webp">\n    \t<source srcset="img/cat_result_xs${e}.png" media="(max-width: 767px)">\n    \t<img src="img/cat_result_sm${e}.png" alt="result">\n    \t</picture>`),$(resultTitle).transit({opacity:"1",rotateY:"360deg"},400).transit({scale:0,y:"-190px",opacity:"0",delay:1500},400,"ease"),resultType.style.display="block",$(resultType).transit({opacity:"1",rotateX:"720deg"},500).transit({scale:.8,y:"-15vh",delay:2e3},500,"ease"),$(resultCat).transit({opacity:"1"},500).transit({scale:.7,y:"-25vh",delay:2e3},500,"ease"),$(resultText).transit({opacity:"1",y:"-17vh",delay:2300},500,showFinalBlock())}function hideOtherAnswersOnclick(e){for(let t=0;t<answers.length;t++)t!==e&&$(answers[t]).transit({opacity:"0"},300),t==e&&(console.log(t,e),$(answers[t]).prop("disabled",!0),$(answers[t]).css("background-color","#FF9800"),$(answers[t]).css("opacity","1"),setTimeout(()=>{$(answers[t]).prop("disabled",!1),$(answers[t]).css("background-color","#FF6F32"),$(answers[t]).css("opacity","unset")},1e3)),pageCounter<questionsArray.length-1&&setTimeout(()=>{$(answers[t]).transit({opacity:"1"},0)},1300)}function loadNewQuestion(e){document.removeEventListener("click",answersAddListenerToAnswer),answersContainer.style.overflow="hidden",setTimeout(()=>{answersContainer.style.overflow="auto"},1e3),hideOtherAnswersOnclick(e),setTimeout(()=>{$(question).transit({x:"0",opacity:"0"},400)},600),$(tail).transit({x:"0",opacity:"0"},100),++pageCounter<questionsArray.length?setTimeout(()=>{nextQuestion(pageCounter)},800):setTimeout(()=>{loadResultPage()},500)}function showValidationError(){$(emailInput).addClass("final-block__email-input_error"),$(emailInput).transit({x:"10px"},50).transit({x:"-20px"},50).transit({x:"0px"},50).transit({x:"10px"},50).transit({x:"-20px"},50).transit({x:"0px"},50),$error.css("opacity","1"),$error.fadeIn(),$error.text("Адрес не прошел валидацию. Попробуйте еще раз.")}function validateEmail(){let e=$(".final-block__email-input").val();0===e.length&&showValidationError();return/[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(String(e).toLowerCase())}function refreshCheckbox(){checkboxLabel.classList.remove("final-block__checkbox-label_error")}function checkCheckbox(){return $(checkbox).is(":checked")?(checkboxLabel.classList.remove("final-block__checkbox-label_error"),!0):(checkboxLabel.classList.add("final-block__checkbox-label_error"),!1)}function validate(){validateEmail()?($(emailInput).removeClass("final-block__email-input_error"),$error.fadeOut()):showValidationError()}checkboxLabel.addEventListener("click",refreshCheckbox),emailInput.addEventListener("blur",validate);let finalBlockCounter=0;function moveFinalBlock(){let e=.85*$(".final-block").height();finalBlockCounter%2==0?($(".final-block").transit({y:`-${e}`},600),setTimeout(()=>{$(".final-block__arrow").addClass("arrow_still")},550)):($(".final-block").transit({y:"0"},600),setTimeout(()=>{$(".final-block__arrow").removeClass("arrow_still")},550)),finalBlockCounter++}finalBlockArrow.addEventListener("click",moveFinalBlock),finalBlockTitle.addEventListener("click",moveFinalBlock);let emailTestSet=new Set;function checkEmailBase(){let e=$(".final-block__email-input").val().toString().toLowerCase();emailTestSet.has(e)?(document.querySelector(".popup-final__text").textContent="Такой email уже участвует в Акции",document.querySelector(".popup-final__icon-img").src="img/popup_error.png",document.querySelector(".popup-final__line").style.opacity="0"):(emailTestSet.add(e),document.querySelector(".popup-final__text").textContent="Спасибо, ты участвуешь в Акции!",document.querySelector(".popup-final__icon-img").src="img/popup_success.png",document.querySelector(".popup-final__line").style.opacity="1")}function showPopup(){checkEmailBase(),$(popup).fadeOut(0).css("opacity","1"),$(popup).css("opacity","1").fadeIn(300)}function sendForm(){validateEmail(),checkCheckbox(),checkCheckbox()&&validateEmail()&&setTimeout(()=>{showPopup()},300)}emailTestSet.add("test@mail.ru"),emailTestSet.add("test2@gmail.com"),sendButton.addEventListener("click",sendForm),answersContainer.addEventListener("scroll",function(){document.querySelector(".js_last").getBoundingClientRect().bottom<window.innerHeight+50?$(".answers__arrow").addClass("arrow_still"):$(".answers__arrow").removeClass("arrow_still")}),checkboxLabel.addEventListener("focus",function(){checkboxLabel.addEventListener("keydown",function(){$(checkbox).is(":checked")?$(checkbox).prop("checked",!1):$(checkbox).prop("checked",!0)})});